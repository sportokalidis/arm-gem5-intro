# Energy-Delay-Area Product Optimization (gem5 + McPat) 

## Introduction

> TODO: ADD IMAGE , AN INTRO TO MCPAT
---

## Answer to questions

### _Part_1. Introduction to McPat simulator_

#### 1. Dynamic power and leakage

**Dynamic power:** Στα chips τεχνολογίας CMOS, η παραδοσιακά πρωτεύουσα πηγη καταναλωσης ενεργειας, σχετιζεται με την μεταγωγη των transistors  (switching) και ονομάζεται δυναμική ισχύς (dynamic power). Η ισχυς που απαιτειται ανα transistor είναι ανάλογη του γινομένου της χωρητικότητας φορτιου (load capacitance) του  transistor, του τετραγώνου της τάσης και της συχνότητας της μεταγωγής (frequency of switching), όπου μοναδα μετρησης ειναι το watt.

> **Dynamic Power = 1/2 * Capacitive_Load * Voltage<sup>2</sup>  * Frequency_switching**

Παρόλο που, στη τεχνολογία CMOS, η δυναμική ισύς, αποτελεί την κυρια πηγή κατανάλωσης ισχύος, η στατική ισχύς (static power), εχει ιδιαίτερη σπουδαιότητα, επειδή το ρευμα διαρροής (leakage current), εξακολουθεί να κυκλοφορεί ακόμα και όταν το transitor ειναι κλειστο.

> **Static Power = Static_Current * Voltage** 

**Static Power:** είναι το μέρος της κατανάλωσης ρεύματος που είναι ανεξάρτητο από τη δραστηριότητα. Περιλαμβάνει την ισχύ διαρροής και ισχύ αναμονής (leakage power and standby power). Η ισχύς διαρροής (leakage power) είναι η ισχύς που καταναλώνεται από το τρανζίστορ σε κατάσταση εκτός λειτουργίας λόγω του ανάστροφου ρεύματος. Η ισχύς αναμονης (standby power) οφείλεται στο σταθερό ρεύμα από το Vdd στο έδαφος. 

**Leakage Power:** Όταν τα transistors βρίσκονται σε κατάσταση εκτός λειτουργίας, στην ιδανική περίπτωση δεν πρέπει να διαρεονται από ρεύμα. Αυτό δεν συμβαίνει στην πραγματικότητα: Υπάρχει κάποια ποσότητα ρεύματος που κυκλοφορεί ακόμα και στην κατάσταση εκτός λόγω του ανάστρφου ρεύματος στην πηγή, καθώς και του subthreshold ρεύματος που οφείλεται στο φορτίο αναστροφής που υπάρχει στις τάσεις στην πύλη υπό τάση κατωφλίου . Όλα αυτά συλλογικά αναφέρονται ως ρεύμα διαρροής. Αυτό το ρεύμα είναι πολύ μικρό για ένα μόνο τρανζίστορ. Εντούτοις, μέσα σε ένα ολοκληρωμένο κύκλωμα υπάρχουν εκατομμύρια έως δισεκατομμύρια τρανζίστορ, έτσι αυτό το ρεύμα καθίσταται σημαντικό σε επίπεδο ολοκληρωμενου κυκλωματος (IC). Η ισχύς που διαχέεται λόγω αυτού του ρεύματος ονομάζεται ισχύς διαρροής (leakage power). Λόγω του ρεύματος διαρροής και εξαρτάται κυρίως από τη διαδικασία κατασκευής και την τεχνολογία με την οποία κατασκευάζονται τα τρανζίστορ. Δεν εξαρτάται από τη συχνότητα λειτουργίας των flip-flops.

<br/>

#### 2. comparison CPUs

> TODO: ANSWERTO QUESTION

**Ερώτηση:** Σύγκριση δυο διαφορετικών επεξεργαστών. Υποθέτουμε οτι και οι δύο επεξεργαστές εχουν την ίδια χωτητικότητα μπαταρίας και εστω οτι ο πρωτος καταναλωνει 5 Watt, ενω ο δεύτερος καταναλώνει 40 Watt. Μπορεί ο δεύτερος επεξεργαστής, να δινει μεγαλύτερη διάρκεια μπαταρίας; <br/><br/>

**Απάντηση:** Ναι, είναι δυνατόν να συμβεί αυτό, διότι, ο δεύτερος μπορεί να είναι γρηγορότερο και να εχει μικρη καταναλωση ενεργειας στην περιοδο αδράνειας. Για παράδειγμα, αν ο δευτερος εκτελεί μια συγκεκριμένη διαδικασία 40 φορες πιο γρηγορα, τοτε, μια εφαρμογη που ο 2ος την εκτελεί σε 1 sec, ο 1ος την εκτελεί σε 40 secs. Ετσι, για αυτην την εφαρμογη ο 1ος καταναλωνει Ε = 5 * 40 Joule, ενω, ο 2ος καταναλώνει Ε = 40 * 1 Joule.      








<br/>


#### 3. XEON vs ARM_A9_2GHz
<br/>

_McPat results:_ <br/> 
- [Xeon results]()
- [ARM A9 results]()

> TODO: ADD LINK FOR RESULTS

|Processor| Runtime Dynamic| Total Leakage  |     Area      |Peak Power  |Peak Dynamic|Subthreshold Leakage|Gate Leakage |
|:--------|:--------------:|:--------------:|:-------------:|:----------:|:----------:|:------------------:|:-----------:|
|**Xeon**  |   72.9199 W    |    36.8319 W   | 410.507 mm^2  | 134.938 W  | 98.1063 W  |    35.1632 W       | 1.66871 W   |
|**ARM A9**|   2.96053 W    |    0.108687 W  | 5.39698 mm^2  | 1.74189 W  |  1.6332 W  |    0.0523094 W     |  0.0563774 W|

<br/>

Υποθέτουμε ότι ο Xeon και o ARM Α9 μπορούν να τρέξουν την ίδια ακριβώς εφαρμογή και οτι ο XEON ειναι 40 φορές πιο γρήγορος.
Ωστόσο, ο XEON δεν διακόπτει την λειτουργία του μετά την ολοκηρώση της εκτέλεσης και παραμένει σε αδράνεια. Παρατηρόντας, τα αποτελέσματα απο το McPat, βλέπουμε οτι ο Xeon δε μπορει να ειναι ενεργειακά αποδοτικότερος απο τον ARM A9 παρα την καλυτερη αποδοση στου στον χρονο εκτελεσης της εφαρμογης. Αυτό συμβαινει γιατι κατα την περίοδο αδράνειας, ο επεξεργαστης συνεχίζει να καταναλώνει ενεργεια που εξαρταται απο το leakage power. <br/><br/>

***Παράδειγμα:*** <br/>
Έστω, ότι η εφαρμογή διαρκει 1 second στον Xeon, αρα, στον ARM A9 διαρκεί 40 seconds. <br/>
> **Total_Energy = (Dynamic_Power * dt) + (Leakage_Power * dt)**
<br/>

Αρα, στον **Xeon** έχουμε: <br>

Total_Energy = 1 (sec) * 72 (Joule/sec) + 39 (secs) * 36 (Joule/sec) => <br/>
**Total_Energy = 1476 Joule** <br/><br/>

Αντίστοιχα, στον **ARM A9** έχουμε: <br>

Total_Energy = 40 (sec) * 3 (Joule/sec) + 0 (secs) * 0.1 (Joule/sec) => <br/>
**Total_Energy = 120 Joule** <br/><br/>

Παρατηρούμε, λοιπόν, οτι ο Xeon στη περίοδο αδράνειας καταναλώνει περισσότερο ενέργεια απο ότι καταναλωνει ο ΑRM A9 κατα την εκτέλεση της εφαρμογης. Αρα, σε καθε περίπτωση ο Xeon θα καταναλώνει περισσότερο ενεργεια.  

<br/>

---

### _Part_2. gem5 + McPat: EDAP optimization_

Σε αυτό το μέρος της εργαστηριακής άσκησεις, θα χρησιμοποιήσουμε τα αποτελέσματα, απο την προηγούμενη εργαστηριακή άσκηση, όπου μας είχε ζητηθεί να βελτιστοποιήσουμε τον επεξεργαστη με βάση μια συνάρτηση κόστους. Το repository της δευτερης εργαστηριακής άσκησης βρισκεται [here](https://github.com/sportokalidis/Gem5_Design_Space_Exploration). Σκοπός αυτου τπυ μέρους είναι να βρούμε την καλύτερη λύση που να βελτιστοποιεί το γινόμενο Energy-Delay-Area (EDAP).

#### _1. Take results_
**Area:** το παίρνουμε απο το άθροισμα του area του core και του L2, απο την εξοδο του McPat.<br/>
**Delay:** απο τo stats,txt που παραγεται από τον gem5.<br/>
**energy:** απο την εξοδο του McPat παίρνουμε το Leakage power και το Dynamic power καθως και το execution time απο το stats.txt απο την εξοδο του gem5 και υπολογιζουμε το energy

> **Energy = (Dynamic_power + leakage_power) * execution_time**

για ευκολια χρησιμοποιυμε το αρχειο [**print_energy.py**]()

> TODO: ΝΑ βαλω link sto file



#### _2. Results_
<br/>

**specbzip** <br/>

|file  | L1 icache size| L1 dcache size | L2 cache size|L1 icache assoc|L1 dcache assoc|L2 cache assoc|cache line size|
|:----:|:-------------:|:--------------:|:------------:|:-------------:|:-------------:|:------------:|:-------------:|
|file 1|32 KB          |128 KB          |2 MB          |1              |1              |8             |128 Bytes      |
|file 2|32 KB          |128 KB          |2 MB          |2              |2              |8             |128 Bytes      |
|file 3|32 KB          |64 KB           |4 MB          |2              |2              |8             |128 Bytes      |
|file 4|64 KB          |32 KB           |2 MB          |2              |2              |8             |128 Bytes      |
|file 5|128 KB         |128 KB          |4 MB          |4              |2              |8             |128 Bytes      |

<br/>

**McPat output**<br/>

|file  |Area |Runtime Dynamic |Subthreshold Leakage |Gate Leakage |Peak Power|
|------|:---:|:--------------:|:-------------------:|:-----------:|:--------:|
|file 1|51 mm^2 |0.979 W    | 1.26382 W           |0.010754 W   |9.49383 W |
|file 2|52 mm^2 |1.018 W    | 1.37665 W           |0.011824 W   |10.2015 W |
|file 3|30 mm^2 |1.012 W    | 1.372 W             |0.010105 W   |9.5333  W |
|file 4|1521 mm^2 |0.984 W    | 2.29543 W           |0.103215 W   |18.0372 W |
|file 5|41 mm^2 |1.910 W    | 1.83167 W           |0.013102 W   |13.591  W |

<br/>

**EDAP** <br/>

|file  |Energy|Area |Delay |EDAP |
|------|:----:|:---:|:----:|:---:|
|file 1|194|51|0.086316|854.010504|
|file 2|203|52|0.084722|894.325432|
|file 3|200|30|0.083625|501.75|
|file 4|284|1521|0.084149|3634.9338636|
|file 5|580|41|0.154665|3677.9337|

<br/>
<img src=part_2/diagrams/bzip_area.png width=700 height=400/>
<br/>

<br/>
<img src=part_2/diagrams/bzip_peak_power.png width=700 height=400/>
<br/>

<br/>
<img src=part_2/diagrams/bzip_EDAP.png width=700 height=400/>
<br/>

<br/><br><br/>



**spechmmer**<br/>

|file  | L1 icache size| L1 dcache size | L2 cache size|L1 icache assoc|L1 dcache assoc|L2 cache assoc|cache line size|
|:----:|:-------------:|:--------------:|:------------:|:-------------:|:-------------:|:------------:|:-------------:|
|file 1|64 KB          |64 KB           |2 MB          |2              |2              |8             |128 Bytes      |
|file 2|64 KB          |128 KB          |2 MB          |2              |2              |8             |128 Bytes      |
|file 4|128 KB         |128 KB          |1 MB          |4              |8              |4             |128 Bytes      |
|file 5|128 KB         |128 KB          |1 MB          |4              |8              |2             |128 Bytes      |

<br/>

**McPat output**<br/>

|file  |Area |Runtime Dynamic |Subthreshold Leakage |Gate Leakage |Peak Power|
|------|:---:|:--------------:|:-------------------:|:-----------:|:--------:|
|file 1|50 mm^2 |0.644 W    | 1.34256 W           |0.011733 W   |9.91251 W |
|file 2|52 mm^2 |0.644 W    | 1.47694 W           |0.011824 W   |11.0655 W |
|file 4|35 mm^2 |0.984 W    | 1.63374 W           |0.012160 W   |11.7676 W |
|file 5|35 mm^2 |1.123 W    | 1.83167 W           |0.013102 W   |13.591  W |

<br/>

**EDAP** <br/>

|file  |Energy|Area |Delay |EDAP |
|------|:----:|:---:|:----:|:---:|
|file 1|115|50|0.117785|677.26375|
|file 2|123|52|0.057998|370.955208|
|file 4|326|35|0.058372|666.02452|
|file 5|326|35|0.11778|1343.8698|

<br/><br/><br/>



**speclibm**<br/>

|file  | L1 icache size| L1 dcache size | L2 cache size|L1 icache assoc|L1 dcache assoc|L2 cache assoc|cache line size|
|:----:|:-------------:|:--------------:|:------------:|:-------------:|:-------------:|:------------:|:-------------:|
|file 1|64 KB          |32 KB           |4 MB          |1              |1              |8             |128 Bytes      |
|file 4|128 KB         |128 KB          |2 MB          |1              |4              |1             |256 Bytes      |
|file 5|128 KB         |128 KB          |4 MB          |2              |2              |1             |256 Bytes      |
|file 6|32 KB          |64 KB           |2 MB          |4              |2              |1             |256 Bytes      |

<br/>


**McPat output**<br/>

|file  |Area |Runtime Dynamic |Subthreshold Leakage |Gate Leakage |Peak Power|
|------|:---:|:--------------:|:-------------------:|:-----------:|:--------:|
|file 1|26 mm^2 |0.153 W    | 1.10138 W           |0.008058 W   |8.04241 W |
|file 4|99 mm^2 |1.858 W    | 2.99405 W           |0.026583 W   |31.5029 W |
|file 5|98 mm^2 |0.984 W    | 2.95155 W           |0.0262717 W   |31.035 W |
|file 6|99 mm^2 |1.686 W    | 1.83167 W           |0.013102 W   |13.591  W |

<br/>

**EDAP** <br/>

|file  |Energy|Area |Delay |EDAP |
|------|:----:|:---:|:----:|:---:|
|file 1|165|26|0.16547|709.8663|
|file 4|807|99|0.165471|13219.974603|
|file 5|771|98|0.16547|12502.58226|
|file 6|777|99|0.16547|12728.44881|


<br/><br/><br/>




**specmcf**<br/>


|file  | L1 icache size| L1 dcache size | L2 cache size|L1 icache assoc|L1 dcache assoc|L2 cache assoc|cache line size|
|:----:|:-------------:|:--------------:|:------------:|:-------------:|:-------------:|:------------:|:-------------:|
|file 1|32 KB          |128 KB          |2 MB          |1              |1              |8             |128 Bytes      |
|file 3|128 KB         |128 KB          |4 MB          |2              |2              |8             |128 Bytes      |
|file 4|128 KB         |128 KB          |2 MB          |2              |2              |8             |128 Bytes      |
|file 5|128 KB         |128 KB          |4 MB          |4              |2              |8             |128 Bytes      |

<br/>

**McPat output**<br/>

|file  |Area |Runtime Dynamic |Subthreshold Leakage |Gate Leakage |Peak Power|
|------|:---:|:--------------:|:-------------------:|:-----------:|:--------:|
|file 1|8 mm^2 |0.152 W    | 1.83717 W             |0.00421343 W |13.7281 W |
|file 3|35 mm^2 |0.918 W    | 1.84069 W             |0.0131573 W  |11.5051 W |
|file 4|41 mm^2 |1.869 W    | 2.95155 W             |0.0132376W   |13.5828 W |
|file 5|38 mm^2 |1.860 W    | 1.83167 W             |0.013102 W   |13.591  W |


<br/>

**EDAP** <br/>

|file  |Energy|Area |Delay |EDAP |
|------|:----:|:---:|:----:|:---:|
|file 1|53|8|0.112188|47.567712|
|file 3|283|35|0.064417|638.050385|
|file 4|413|41|0.111368|1885.794344|
|file 5|414|38|0.111112|1748.013984|

<br/><br/><br/>



**specsjeng**<br/>


|file  | L1 icache size| L1 dcache size | L2 cache size|L1 icache assoc|L1 dcache assoc|L2 cache assoc|cache line size|
|:----:|:-------------:|:--------------:|:------------:|:-------------:|:-------------:|:------------:|:-------------:|
|file 2|64 KB          |32 KB           |4 MB          |1              |1              |8             |128 Bytes      |
|file 5|32 KB          |64 KB           |512 kB        |2              |2              |1             |128 Bytes      |
|file 8|64 KB          |64 KB           |512 KB        |4              |2              |1             |128 Bytes      |


**McPat output**<br/>

|file  |Area |Runtime Dynamic |Subthreshold Leakage |Gate Leakage |Peak Power|
|------|:---:|:--------------:|:-------------------:|:-----------:|:--------:|
|file 2|26 mm^2 |0.136 W     | 1.10138 W             |0.00805859 W |8.04241 W |
|file 5|26 mm^2 |0.319 W    | 1.23409 W             |0.00937864 W  |8.71127 W |
|file 8|29 mm^2 |0.628 W    | 1.47158 W             |0.0109143 W   |10.304 W |

<br/>

**EDAP** <br/>

|file  |Energy|Area |Delay |EDAP |
|------|:----:|:---:|:----:|:---:|
|file 2|423|26|0.339891|3738.121218|
|file 5|531|26|0.34007|4695.00642|
|file 8|1050|29|0.497655|15153.59475|






